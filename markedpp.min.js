/*!
 * markedpp
 *
 * A preprocessor for markdown files
 *
 * @copyright 2014 commenthol
 * @licence MIT
 *
 * @note Code inspired by `marked` project
 * @credits Christopher Jeffrey <https://github.com/chjj/marked>
 */
(function(e){"use strict";var t={gfm:true,include:true,toc:true,numberedheadings:true,ref:true,breaks:true,tags:true,level:3,minlevel:1,autonumber:true,autoid:true};function n(){return typeof process!=="undefined"&&typeof module!=="undefined"&&module.exports}function r(e,t){e=e.source;t=t||"";return function n(r,i){if(!r)return new RegExp(e,t);i=i.source||i;i=i.replace(/(^|[^\[])\^/g,"$1");e=e.replace(r,i);return n}}function i(){}i.exec=i;function s(e){var t=1,n,r;for(;t<arguments.length;t++){n=arguments[t];for(r in n){if(Object.prototype.hasOwnProperty.call(n,r)){e[r]=n[r]}}}return e}function o(e,t){var n=parseInt(e,10);if(isNaN(n)){if(t===true)return;else return e}return n}var p={normalizeArray:function(e,t){var n=0;for(var r=e.length-1;r>=0;r--){var i=e[r];if(i==="."){e.splice(r,1)}else if(i===".."){e.splice(r,1);n++}else if(n){e.splice(r,1);n--}}if(t){for(;n--;n){e.unshift("..")}}return e},resolve:function(){var e="",t=false;for(var n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:"/";if(!r){continue}e=r+"/"+e;t=r.charAt(0)==="/"}e=this.normalizeArray(e.split("/").filter(function(e){return!!e}),!t).join("/");return(t?"/":"")+e||"."},splitPathRe:/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath:function(e){return this.splitPathRe.exec(e).slice(1)},dirname:function(e){var t=this.splitPath(e),n=t[0],r=t[1];if(!n&&!r){return"."}if(r){r=r.substr(0,r.length-1)}return n+r},join:function(){return Array.prototype.slice.call(arguments).join("/")}};var u={_eachLimit:function(e){return function(t,n,r){r=r||function(){};if(!t.length||e<=0){return r()}var i=0;var s=0;var o=0;(function p(){if(i>=t.length){return r()}while(o<e&&s<t.length){s+=1;o+=1;n(t[s-1],function(e){if(e){r(e);r=function(){}}else{i+=1;o-=1;if(i>=t.length){r()}else{p()}}})}})()}},eachLimit:function(e,t,n,r){var i=this._eachLimit(t);i.apply(null,[e,n,r])}};function l(e,t,n){if(typeof t==="function"){n=t;t=null}var r=t?t:{};var i=new XMLHttpRequest,s=r.method||"get",o=typeof r.async!=="undefined"?r.async:true,p=r.data||null,u;i.queryString=p;i.open(s,e,o);i.setRequestHeader("X-Requested-With","XMLHttpRequest");if(s.toLowerCase()=="post"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}for(u in r.headers){if(r.headers.hasOwnProperty(u)){i.setRequestHeader(u,r.headers[u])}}function l(){if(i.readyState===4){if(/^[20]/.test(i.status)){n(null,i.responseText)}else if(/^[45]/.test(i.status)){n(new Error(i.status))}}}if(o){i.onreadystatechange=l}i.send(p);if(!o)l()}var a;if(n()){a=require("./ppinclude")(c,s)}else{a=function(e,t,n){var r=t.dirname||"/",i={},o=s({},t);if(!o.ppInclude){o.ppInclude={}}u.eachLimit(e,5,function(e,t){if(e.type==="ppinclude"&&typeof e.text==="string"&&!o.ppInclude[e.text]){var n=p.resolve(p.join(p.dirname(location.pathname),r,e.text));var s=location.origin+n;l(s,function(r,s){o.ppInclude[e.text]=1;o.dirname=p.dirname(n);if(r){console.error("Error: "+r.message);return t()}var u=new c(o);s=e.indent+s.split("\n").join("\n"+e.indent);a(u.lex(s),o,function(n,r){i[e.text]=r;t()})})}else{t()}},function(t){var r=[];e.forEach(function(e,t){if(e.type==="ppinclude"&&typeof e.text==="string"&&i[e.text]!==undefined){r.push({type:"ppinclude_start",text:e.text,indent:e.indent,lang:e.lang});i[e.text].forEach(function(e){r.push(s({},e))});r.push({type:"ppinclude_end",lang:e.lang})}else{r.push(e)}});n(null,r)})}}var h={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:i,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n|$)/,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*)+(?:\n|$)/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n?|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n|$)/,table:i,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/,ppinclude:i,ppnumberedheadings:i,pptoc:i,ppref:i};h.bullet=/(?:[*+-]|\d+\.)/;h.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;h.item=r(h.item,"gm")(/bull/g,h.bullet)();h.list=r(h.list)(/bull/g,h.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+h.def.source+")")();h.blockquote=r(h.blockquote)("def",h.def)();h._tag="(?!(?:[A-Za-z][A-Za-z-]*)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b";h.html=r(h.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,h._tag)();h.paragraph=r(h.paragraph)("hr",h.hr)("heading",h.heading)("lheading",h.lheading)("blockquote",h.blockquote)("tag","<"+h._tag)("def",h.def)();h.opts={};h.opts.gfm={fences:/^( *)(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\2 *(?:\n|$)/};var f={_ppopts_:/ ?(?:\(([^\)]+)\))?/,ppinclude:/^( *)(?:\!(?:include)_ppopts_|_ppinclude_|_ppincludeCompat_) *(?:\n|$)/,_ppinclude_:/<!-- *include_ppopts_ *-->(?:(?!<!-- *\/include * -->)[^])*<!-- *\/include * -->/,_ppincludeCompat_:/\!INCLUDE "([^"]+)"/,ppnumberedheadings:/^ *(?:\!(?:numberedheadings)_ppopts_|_ppnumberedheadings_) *(?:\n+|$)/,_ppnumberedheadings_:/<!-- \!*numberedheadings_ppopts_ *-->/,pptoc:/^(?:\!(?:toc)_ppopts_|_pptoc_|_pptocCompat1_|_pptocCompat2_|_pptocCompat3_) *(?:\n+|$)/,_pptoc_:/<!-- *\!toc_ppopts_ *-->(?:(?!<!-- *toc\! * -->)[^])*<!-- *toc\! * -->/,_pptocCompat1_:/\!TOC/,_pptocCompat2_:/<!-- *toc *-->(?:(?!<!-- *(?:\/toc|toc stop) * -->)[^])*<!-- *(?:\/toc|toc stop) * -->/,_pptocCompat3_:/<!-- *toc *-->/,ppref:/^(?:\!(?:ref)|_ppref_|_pprefCompat1_|_pprefCompat2_) *(?:\n|$)/,_ppref_:/<!-- *\!ref *-->(?:(?!<!-- *ref\! * -->)[^])*<!-- *ref\! * -->/,_pprefCompat1_:/\!REF/,_pprefCompat2_:/<!-- *ref *-->(?:(?!<!-- *\/ref * -->)[^])*<!-- \/ref * -->/};f.ppinclude=r(f.ppinclude)("_ppinclude_",f._ppinclude_)("_ppincludeCompat_",f._ppincludeCompat_)("_ppopts_",f._ppopts_)("_ppopts_",f._ppopts_)();f.ppnumberedheadings=r(f.ppnumberedheadings)("_ppnumberedheadings_",f._ppnumberedheadings_)("_ppopts_",f._ppopts_)("_ppopts_",f._ppopts_)();f.pptoc=r(f.pptoc)("_pptoc_",f._pptoc_)("_ppopts_",f._ppopts_)("_ppopts_",f._ppopts_)("_pptocCompat1_",f._pptocCompat1_)("_pptocCompat2_",f._pptocCompat2_)("_pptocCompat3_",f._pptocCompat3_)();f.ppref=r(f.ppref)("_ppref_",f._ppref_)("_pprefCompat1_",f._pprefCompat1_)("_pprefCompat2_",f._pprefCompat2_)();h.opts.include={ppinclude:f.ppinclude};h.opts.numberedheadings={ppnumberedheadings:f.ppnumberedheadings};h.opts.toc={pptoc:f.pptoc};h.opts.ref={ppref:f.ppref};function c(e){this.tokens=[];this.options=e||t;this.rules=h;if(this.options.gfm){s(this.rules,h.opts.gfm)}if(this.options.include){s(this.rules,h.opts.include)}if(this.options.numberedheadings){s(this.rules,h.opts.numberedheadings)}if(this.options.toc){s(this.rules,h.opts.toc)}if(this.options.ref){s(this.rules,h.opts.ref)}}c.prototype.lex=function(e){e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(e,true)};c.prototype.token=function(e,n){var r,i,s,p,u,l,a,h,f,d,m,_,k=this;while(e){if(r=this.rules.newline.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"space",text:r[0]})}if(r=this.rules.ppinclude.exec(e)){e=e.substring(r[0].length);d=r[2]||r[3]||r[4];_=c.splitOpts(d);d=d.replace(/ *(?:[a-z]+=[a-z0-9\-]+)/,"").replace(/\\ /g," ");this.tokens.push({type:"ppinclude",text:d,indent:r[1],lang:_.lang});continue}if(r=this.rules.code.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"code",text:r[0]});continue}if(r=this.rules.fences.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"fences",indent:r[1],fences:r[2],lang:r[3],text:r[4]});continue}if(r=this.rules.heading.exec(e)){e=e.substring(r[0].length);d=new g(this.options);this.tokens.push({type:"heading",depth:r[1].length,text:r[2],raw:r[2],autoid:null,inline:d.lex(r[2])});continue}if(r=this.rules.lheading.exec(e)){e=e.substring(r[0].length);d=new g(this.options);this.tokens.push({type:"heading",depth:r[2]==="="?1:2,text:r[1],raw:r[1],inline:d.lex(r[1])});continue}if(r=this.rules.hr.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"hr",text:r[0]});continue}if(r=this.rules.blockquote.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"blockquote_start"});r=r[0].replace(/^ *> ?/gm,"");this.token(r,n);this.tokens.push({type:"blockquote_end"});continue}if(r=this.rules.list.exec(e)){e=e.substring(r[0].length);i=r[2];this.tokens.push({type:"list_start",ordered:i.length>1,start:o(i,true)});r=r[0].match(this.rules.item);s=false;p=r.length;u=0;for(;u<p;u++){l=r[u];i=this.rules.bullet.exec(l)[0];a=l.length;l=l.replace(/^ *([*+-]|\d+\.) +/,"");if(~l.indexOf("\n ")){a-=l.length;l=!this.options.pedantic?l.replace(new RegExp("^ {1,"+a+"}","gm"),""):l.replace(/^ {1,4}/gm,"")}if(this.options.smartLists&&u!==p-1){b=this.rules.bullet.exec(r[u+1])[0];if(i!==b&&!(i.length>1&&b.length>1)){e=r.slice(u+1).join("\n")+e;u=p-1}}h=s||/\n\n(?!\s*$)/.test(l);if(u!==p-1){s=l.charAt(l.length-1)==="\n";if(!h)h=s}this.tokens.push({type:h?"loose_item_start":"list_item_start",text:i});this.token(l,false,f);this.tokens.push({type:"list_item_end"})}this.tokens.push({type:"list_end"});continue}if(r=this.rules.ppnumberedheadings.exec(e)){e=e.substring(r[0].length);_=c.splitOpts(r[1]||r[2]);if(typeof _.omit==="string"){_.omit=[_.omit]}this.options.numberedHeadings=true;this.tokens.push({type:"ppnumberedheadings",level:c.range(_.level,t.minlevel,6,t.level),minlevel:c.range(_.minlevel,t.minlevel,6),skip:_.skip,start:_.start,omit:_.omit});continue}if(r=this.rules.pptoc.exec(e)){e=e.substring(r[0].length);_=c.splitOpts(r[1]||r[2]);if(typeof _.omit==="string"){_.omit=[_.omit]}this.tokens.push({type:"pptoc",level:c.range(_.level,t.minlevel,6,t.level),minlevel:c.range(_.minlevel,t.minlevel,6),numbered:_.numbered,omit:_.omit});continue}if(r=this.rules.ppref.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"ppref"});continue}if(r=this.rules.html.exec(e)){e=e.substring(r[0].length);this.tokens.push({type:"html",pre:r[1]==="pre"||r[1]==="script"||r[1]==="style",text:r[0]});continue}if(n&&(r=this.rules.def.exec(e))){e=e.substring(r[0].length);this.tokens.push({type:"def",ref:r[1],href:r[2],title:r[3]});continue}if(n&&(r=this.rules.paragraph.exec(e))){e=e.substring(r[1].length);d=new g(this.options);this.tokens.push({type:"paragraph",text:r[1],inline:d.lex(r[1])});continue}if(r=this.rules.text.exec(e)){e=e.substring(r[0].length);d=new g(this.options);this.tokens.push({type:"text",text:r[0],inline:d.lex(r[0])});continue}if(e){throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}}return this.tokens};c.rules=h;c.lex=function(e,t,n){var r=new c(t);var i=r.lex(e);a(i,t,function(e,r){n(e,r,t)})};c.splitOpts=function(e){var t={},n,r="",i=/^(.+)$/,s=/^([a-z0-9]+)=(.*)$/,o=/^([a-z0-9]+)=(["'])(.*?)\2$/;(e||"").split(" ").forEach(function(e){if(/\\$|^["'].*[^"']$/.test(e)||n&&!n.test(e)){r+=e+" ";return}if(/\=(["']).*[^"']$/.test(e)){n=e.replace(/^.*\=(["']).*[^"']$/,"$1");n=new RegExp(n+"$");r+=e+" ";return}if(r){e=r+e;r="";n=undefined}if(o.test(e)){e.replace(o,function(e,n,r,i){t[n]=i.split(";");t[n]=t[n].map(function(e){if(/^\d+$/.test(e)){var t=parseInt(e,10);if(!isNaN(t)){e=t}}return e});if(t[n].length===1){t[n]=t[n][0]}})}else if(s.test(e)){e.replace(s,function(e,n,r){var i=parseInt(r,10);if(!isNaN(i)){r=i}t[n]=r})}else if(i.test(e)){e=e.replace(/\\ /g," ").replace(/^(["'])([^\1]+)\1$/,"$2");if(/^\!(.*)$/.test(e)){e=e.replace(/^\!(.*)$/,"$1");t[e]=false}else{t[e]=true}}});return t};c.range=function(e,t,n,r){if(e<t){return t}else if(e>n){return n}else{if(r&&e===r){return undefined}return e}};var d={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:i,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^(!)?\[(inside)\]\(href\)/,reflink:/^(!)?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^(!)?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:i,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/,_inside:/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,_href:/\s*<?([\s\S]*?)>?(?:\s+(['"][\s\S]*?['"]))?\s*/};d.link=r(d.link)("inside",d._inside)("href",d._href)();d.reflink=r(d.reflink)("inside",d._inside)();d.opts={};d.opts.gfm={escape:r(d.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:r(d.text)("]|","~]|")("|","|https?://|")()};d.opts.breaks={br:r(d.br)("{2,}","*")(),text:r(d.opts.gfm.text)("{2,}","*")()};function g(e){this.tokens=[];this.options=e||t;this.rules=d;if(this.options.gfm){s(this.rules,d.opts.gfm)}if(this.options.breaks){s(this.rules,d.opts.gfm,d.opts.breaks)}}g.rules=d;g.lex=function(e,t){var n=new g(t);return n.lex(e)};g.prototype.lex=function(e){var t;while(e){if(t=this.rules.escape.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"escape",text:t[1]});continue}if(!this.inLink&&(t=this.rules.url.exec(e))){e=e.substring(t[0].length);this.tokens.push({type:"url",text:t[1]});continue}if(t=this.rules.tag.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"tag",text:t[0]});continue}if(t=this.rules.link.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:t[1]?"image":"link",raw:t[0],text:t[2],href:t[3],title:t[4]});continue}if(t=this.rules.reflink.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:t[1]?"refimage":"reflink",raw:t[0],text:t[2],ref:t[3]});continue}if(t=this.rules.nolink.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:t[1]?"noimage":"nolink",raw:t[0],text:t[2]});continue}if(t=this.rules.strong.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"strong",text:t[2]||t[1],"char":/^(..)/.exec(t[0])[0]});continue}if(t=this.rules.em.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"em",text:t[2]||t[1],"char":/^(.)/.exec(t[0])[0]});continue}if(t=this.rules.code.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"code",text:t[0]});continue}if(t=this.rules.br.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"br",text:t[0]});continue}if(t=this.rules.del.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"del",text:t[1]});continue}if(t=this.rules.text.exec(e)){e=e.substring(t[0].length);this.tokens.push({type:"text",text:t[0]});continue}if(e){throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}}return this.tokens};function m(e){this._=[0,0,0,0,0,0,0];this.last=1;this._[1]=e?e-1:0}m.prototype.reset=function(e){for(var t=e+1;t<this._.length;t++){this._[t]=0}};m.prototype.val=function(e){var t,n=this._[1];for(t=2;t<=e;t++){n+="."+this._[t]}return n+"\\."};m.prototype.count=function(e){if(e<=6){if(this.last>e){this.reset(e)}this._[e]+=1;this.last=e;return this.val(e)}return};function _(e){this.options=e||{}}_.prototype.heading=function(e,t,n,r,i){var s="########".substring(0,t);return s+" "+e+"\n"};_.prototype.paragraph=function(e){return e};_.prototype.newline=function(e){return e};_.prototype.blockquote=function(e){return e.replace(/\n$/,"").replace(/^/gm,"> ")+"\n"};_.prototype.list=function(e,t){return e.replace(/\n$/,"")};_.prototype.listitem=function(e,t){var n,r="";e+=" ";for(n=0;n<e.length;n++){r+=" "}return e+t.replace(/\n(?!\n|$)/gm,"\n"+r)+"\n"};_.prototype.fences=function(e,t,n,r){return this.fence(t,n,r)+e+"\n"+this.fence("",n,r)};_.prototype.reference=function(e,t,n){return"["+e+"]: "+t+(n?' "'+n+'"':"")+"\n"};_.prototype.include=function(e,t,n){return t+"!include ("+e+(n?" lang="+n:"")+")\n"};_.prototype.fence=function(e,t,n){n=n||"```";t=t||"";return t+n+(e?e:"")+"\n"};_.prototype.codeblock=function(e){return e};_.prototype.html=function(e){return e};_.prototype.hr=function(e){return e};_.prototype.escape=function(e){return"\\"+e};_.prototype.url=function(e){return e};_.prototype.tag=function(e){return e};_.prototype.link=function(e,t,n,r){return"["+t+"]("+n+(r?" "+r:"")+")"};_.prototype.reflink=function(e,t,n){return"["+t+"]["+n+"]"};_.prototype.nolink=function(e,t){return"["+t+"]"};_.prototype.image=function(e,t,n,r){return"!"+this.link(e,t,n,r)};_.prototype.refimage=function(e,t,n){return"!"+this.reflink(e,t,n)};_.prototype.noimage=function(e,t){return"!"+this.nolink(e,t)};_.prototype.strong=function(e,t){return t+e+t};_.prototype.em=function(e,t){return t+e+t};_.prototype.del=function(e){return"~~"+e+"~~"};_.prototype.text=function(e){return e};_.prototype.br=function(e){return e};_.prototype.code=function(e){return e};_.sortByTitle=function(e,t){var n=e.title.toLowerCase(),r=t.title.toLowerCase();if(n>r){return 1}else if(n<r){return-1}else{return 0}};_.prototype.references=function(e){var t=[];e.map(function(e){if(!e.title){e.title=e.ref}return e}).sort(_.sortByTitle).forEach(function(e){t.push("* ["+e.title+"]["+e.ref+"]")});if(this.options.tags){return"<!-- !ref -->\n\n"+t.join("\n")+"\n\n<!-- ref! -->\n"}else{return t.join("\n")+"\n"}};_.prototype.tableOfContents=function(e,n){var r=this,i,s,o=[],p=this.joinOpts({level:n.level,minlevel:n.minlevel,numbered:n.numbered,omit:n.omit}),u=new m,l=this.options.breaks?" <br>":"",a=n.level||t.level,h=n.minlevel||t.minlevel;o=e.filter(function(e){if(e.depth<=a&&e.depth>=h){return true}return false}).map(function(e){if(!r.options.numberedHeadings&&n.numbered){e.number=u.count(e.depth-h+1)}return e}).filter(function(e){if(n.omit){if(s){if(e.depth>s){return false}else{s=undefined}}return!n.omit.some(function(t){if(t===e.raw){s=e.depth;return true}return false})}return true}).map(function(e){if(n.numbered){if(r.options.numberedHeadings){return(e.number?e.number+" ":"")+"["+r.sanitizeHeadings(e.raw)+"]("+e.autoid+")"+l}else{return e.number+" ["+r.sanitizeHeadings(e.text)+"]("+e.autoid+")"+l}}else{var t="";for(var i=1;i<(e.depth-h+1||1);i++){t+="  "}return t+"* ["+r.sanitizeHeadings(e.text)+"]("+e.autoid+")"}});if(this.options.tags){return"<!-- !toc "+p+"-->\n\n"+o.join("\n")+"\n\n<!-- toc! -->\n\n"}else{return o.join("\n")+"\n\n"}};_.prototype.numberedHeadings=function(e,t,n,r,i){var s=this.joinOpts({level:e,minlevel:t,skip:n,start:r,omit:i});if(this.options.tags){return"<!-- !numberedheadings "+s+"-->\n\n"}return""};_.prototype.joinOpts=function(e){var t,n,r=[];for(t in e){n=e[t];if(n===true){r.push(t)}else if(n!==undefined){if(Array.isArray(n)){n='"'+n.join(";")+'"'}r.push(t+"="+n)}}if(r.length>0){return"("+r.join(" ")+") "}else{return""}};_.prototype.sanitizeHeadings=function(e){return e.replace(/\[([^\]]*)\]\s*(?:\[[^\]]*\]|\([^\)]*\))/g,"$1")};function k(e){this.tokens=[];this.token=null;this.count=-1;this.indent=[];this.options=e||t;this.options.renderer=this.options.renderer||new _;this.renderer=this.options.renderer;this.renderer.options=this.options}k.prototype.parse=function(e){this.tokens=e;this.updateAutoIdentifier();var t="";while(this.next()){t+=this.tok()}return t};k.prototype.next=function(){this.token=this.tokens[this.count+=1];return this.token};k.prototype.peek=function(){return this.tokens[this.count+1]||0};k.prototype.references=function(){var e,t=[],n={title:{},ref:{}};this.tokens.forEach(function(e){if(e.type==="def"&&!/^#/.test(e.href)){if(e.title){n.title[e.ref]=e.title}else{n.ref[e.ref]=e.ref}}});for(e in n.title){t.push({ref:e,title:n.title[e]})}for(e in n.ref){if(!n.title[e]){t.push({ref:e,title:e})}}return t};k.prototype.tableOfContents=function(){return this.tokens.filter(function(e){if(e.type==="heading"){return true}return false})};k.prototype.headingAutoId=function(e,t){t=t||{raw:false};var n=(!t.raw?e.text:e.raw||"").replace(/^#/,"");if(false){n=e.text.replace(/ /g,"-").replace(/%([abcdef]|\d){2,2}/gi,"").replace(/[\/?:\[\]`.,()*"';{}+<>]/g,"").toLowerCase()}else{n=n.replace(/[^\w]+/g,"-").toLowerCase()}return"#"+n};k.prototype.updateAutoIdentifier=function(){var e=this,t={};function n(t){t=t.replace(/(?:%20|\+)/g," ");t=e.headingAutoId({text:t});return t}this.tokens=this.tokens.map(function(n){var r,i,s;if(n.type==="heading"){i=e.headingAutoId(n);s=e.headingAutoId(n,{raw:true});t[s]=i;t[i]=i;n.autoid=i}return n});this.tokens=this.tokens.map(function(e){var r;if(e.inline){e.inline=e.inline.map(function(e){switch(e.type){case"link":case"image":{r=n(e.href);if(t[r]){e.href=t[r]}break}}return e})}else{switch(e.type){case"def":{r=n(e.href);if(t[r]){e.href=t[r]}break}}}return e})};k.prototype.numberedHeadings=function(e,n,r,i,s){var o=/^([0-9]+\\?\.)+ +/,p={},u=false,l=new m(i);r=r||0;(s||[]).forEach(function(e){p[e]=true});e=e||t.level;n=n||t.minlevel;this.tokens=this.tokens.map(function(t){if(t.type==="heading"){t.text=t.text.replace(o,"");t.raw=t.raw.replace(o,"");if(t.depth===n){if(r>0){r-=1;u=true}else if(r===0){u=false}}if(!u&&!p[t.raw]&&t.depth<=e&&t.depth>=n){t.number=l.count(t.depth-n+1);t.text=t.number+" "+t.text}}return t})};k.prototype.tok=function(e){var t,n,r,i,s,o=this;e=e||{};switch(this.token.type){case"space":{return this.renderer.newline(this.token.text)}case"code":{return this.renderer.codeblock(this.token.text)}case"hr":{return this.renderer.hr(this.token.text)}case"html":{return this.renderer.html(this.token.text)}case"paragraph":{n="";(this.token.inline||[]).forEach(function(e){n+=o.inlinetok(e)});return this.renderer.paragraph(n)}case"text":{n="";(this.token.inline||[]).forEach(function(e){n+=o.inlinetok(e)});return this.renderer.text(n)}case"heading":{return this.renderer.heading(this.token.text,this.token.depth,this.token.raw,this.token.number,this.token.autoid)}case"fences":{return this.renderer.fences(this.token.text,this.token.lang,this.token.indent,this.token.fences)}case"def":{return this.renderer.reference(this.token.ref,this.token.href,this.token.title)}case"blockquote_start":{n="";while(this.next().type!=="blockquote_end"){n+=this.tok()}return this.renderer.blockquote(n)}case"list_start":{n="";s=this.token.ordered;i=this.token.start;while(this.next().type!=="list_end"){if(this.options.autonumber&&s){t={start:i++}}n+=this.tok(t)}return this.renderer.list(n,s)}case"list_item_start":{n="";r=this.token.text;if(e.start){r=e.start+"."}while(this.next().type!=="list_item_end"){n+=this.tok()}return this.renderer.listitem(r,n)}case"loose_item_start":{n="";r=this.token.text;if(e.start){r=e.start+"."}while(this.next().type!=="list_item_end"){n+=this.tok()}return this.renderer.listitem(r,n)}case"ppnumberedheadings":{this.options.numberedHeadings=true;this.numberedHeadings(this.token.level,this.token.minlevel,this.token.skip,this.token.start,this.token.omit);this.updateAutoIdentifier();return this.renderer.numberedHeadings(this.token.level,this.token.minlevel,this.token.skip,this.token.start,this.token.omit)}case"ppref":{return this.renderer.references(this.references())}case"ppinclude_start":{n="";if(typeof this.token.lang==="string"){n=this.renderer.fence(this.token.lang)}return n}case"ppinclude_end":{n="";if(typeof this.token.lang==="string"){n=this.renderer.fence()}return n}case"ppinclude":{return this.renderer.include(this.token.text,this.token.indent,this.token.lang)}case"pptoc":{return this.renderer.tableOfContents(this.tableOfContents(),this.token)}default:{return"<!-- "+JSON.stringify(this.token)+" -->\n"}}};k.prototype.inlinetok=function(e){switch(e.type){case"escape":{return this.renderer.escape(e.text)}case"url":{return this.renderer.url(e.text)}case"tag":{return this.renderer.tag(e.text)}case"link":{return this.renderer.link(e.raw,e.text,e.href,e.title)}case"reflink":{return this.renderer.reflink(e.raw,e.text,e.ref)}case"nolink":{return this.renderer.nolink(e.raw,e.text)}case"image":{return this.renderer.image(e.raw,e.text,e.href,e.title)}case"refimage":{return this.renderer.refimage(e.raw,e.text,e.ref)}case"noimage":{return this.renderer.noimage(e.raw,e.text)}case"strong":{return this.renderer.strong(e.text,e.char)}case"em":{return this.renderer.em(e.text,e.char)}case"text":{return this.renderer.text(e.text)}case"code":{return this.renderer.code(e.text)}case"br":{return this.renderer.br(e.text)}case"del":{return this.renderer.del(e.text)}default:{return"<!-- "+JSON.stringify(this.token)+" -->\n"}}};k.parse=function(e,t){var n=new k(t);return n.parse(e)};function x(e,n,r){if(typeof n==="function"){r=n;n=null}n=s({},t,n||{});c.lex(e,n,function(e,t){var i=k.parse(t,n);r(null,i)})}x.defaults=t;x.Lexer=c;x.merge=s;x.setOptions=function(e){s(t,e);return x};if(n()){module.exports=x}else if(typeof define!=="undefined"&&define.amd){define([],function(){return x})}else if(typeof e.Window!=="undefined"&&!e[x]){e.markedpp=x}})(this);